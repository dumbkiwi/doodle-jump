(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var i=e.g.document;if(!t&&i&&(i.currentScript&&(t=i.currentScript.src),!t)){var s=i.getElementsByTagName("script");if(s.length)for(var o=s.length-1;o>-1&&!t;)t=s[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{constructor(){this._listeners={}}addListener(e,t,s,o){var n;this._listeners[t]=null!==(n=this._listeners[t])&&void 0!==n?n:new i,this._listeners[t].addListener(e,s,o)}removeListener(e,t,s){var o;this._listeners[t]=null!==(o=this._listeners[t])&&void 0!==o?o:new i,this._listeners[t].removeListener(e,s)}on(e,t,s){var o;this._listeners[t]=null!==(o=this._listeners[t])&&void 0!==o?o:new i,this._listeners[t].on(e,s)}once(e,t,s){var o;this._listeners[t]=null!==(o=this._listeners[t])&&void 0!==o?o:new i,this._listeners[t].once(e,s)}off(e,t,s){var o;this._listeners[t]=null!==(o=this._listeners[t])&&void 0!==o?o:new i,this._listeners[t].off(e,s)}emit(e,t,...s){var o;this._listeners[t]=null!==(o=this._listeners[t])&&void 0!==o?o:new i,this._listeners[t].emit(e,...s)}emitAll(e,...t){for(const i in this._listeners)this._listeners[i].emit(e,...t)}}class i{constructor(){this._listeners={}}addListener(e,t,i){var s;this._listeners[e]=null!==(s=this._listeners[e])&&void 0!==s?s:[],this._listeners[e].push({once:i.once,callback:t})}removeListener(e,t){const i=this._listeners[e].findIndex((e=>e.callback===t));if(-1===i)throw new Error("Listener not found");this._listeners[e].splice(i,1)}on(e,t){this.addListener(e,t,{once:!1})}once(e,t){this.addListener(e,t,{once:!0})}off(e,t){this.removeListener(e,t)}emit(e,...t){this.invoke(e,...t)}invoke(e,...t){var i;for(const s of null!==(i=this._listeners[e])&&void 0!==i?i:[])s.callback(...t),s.once&&this.removeListener(e,s.callback)}}class s{constructor(e){this.game=e,this.canvas=e.canvas,this.context=e.context,this.renderEventManager=new i,this.layeredEventManager=new t,this.game.events.on("update",(()=>{this.render()}))}on(e,t,i){this.layeredEventManager.on(e,t,i)}off(e,t,i){this.layeredEventManager.off(e,t,i)}render(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);const e={canvas:this.canvas,context:this.context};this.layeredEventManager.emit("render","background",e),this.layeredEventManager.emit("render","layer_1",e),this.layeredEventManager.emit("render","layer_2",e),this.layeredEventManager.emit("render","layer_3",e),this.layeredEventManager.emit("render","layer_4",e),this.layeredEventManager.emit("render","layer_5",e),this.layeredEventManager.emit("render","foreground",e),this.layeredEventManager.emit("render","ui",e)}}class o{constructor(){this.isRunning=!1,this.timeOutID=void 0,this.callback=void 0,this.step=this.step.bind(this)}step(e){var t;null===(t=this.callback)||void 0===t||t.call(this,e),this.isRunning&&(this.timeOutID=window.requestAnimationFrame(this.step))}start(e){this.isRunning?console.warn("RequestAnimationFrame: start() called while already running"):(this.callback=e,this.timeOutID=window.requestAnimationFrame(this.step),this.isRunning=!0)}stop(){this.isRunning&&this.timeOutID?(window.cancelAnimationFrame(this.timeOutID),this.timeOutID=void 0,this.isRunning=!1):console.warn("RequestAnimationFrame: stop() called while not running")}destroy(){this.stop(),this.callback=void 0}}class n{registerCollider(e){return this.activeColliders.push(e)-1}unregisterCollider(e){this.activeColliders.splice(e,1)}GetActiveColliders(){return this.activeColliders}constructor(e){this.activeColliders=[],this.game=e,e.events.on("start",(()=>{this.startChecking()}))}startChecking(){this.game.events.on("update",(()=>{this.collisionCheck()}))}collisionCheck(){for(const e of this.activeColliders)for(const t of this.activeColliders){if(e.colliderId===t.colliderId)continue;let i=e.isCollidingWith(t);const s=e.getCollidingColliders();e.getActive()&&t.getActive()||(i=!1),i&&void 0===s.find((e=>e.colliderId===t.colliderId))?(e.addCollidingCollider(t),e.emitCollision("collisionEnter",{self:e,other:t})):i&&void 0!==s.find((e=>e.colliderId===t.colliderId))?e.emitCollision("collisionStay",{self:e,other:t}):i||void 0===s.find((e=>e.colliderId===t.colliderId))||(e.removeCollidingCollider(t.colliderId),e.emitCollision("collisionExit",{self:e,other:t}))}}}class r{constructor(){this.isDestroyed=!1,this.isActive=!0}on(e,t){var i;null===(i=this.attachedGameObject)||void 0===i||i.on(e,t)}once(e,t){var i;null===(i=this.attachedGameObject)||void 0===i||i.once(e,t)}off(e,t){var i;null===(i=this.attachedGameObject)||void 0===i||i.off(e,t)}init(e){this.attachedGameObject=e,this.setActive(this.isActive)}destroy(){if(this.isDestroyed)throw new Error("Cannot destroy a destroyed game component");this.isDestroyed=!0,this.attachedGameObject=void 0}setActive(e){this.isActive=e}getActive(){return this.isActive}getType(){return"Forbidden"}getGameObject(){return this.attachedGameObject}setGameObject(e){this.attachedGameObject=e}}class a{constructor(e){this.wrapper=e}on(e,t){this.wrapper.on(e,t)}once(e,t){this.wrapper.once(e,t)}off(e,t){this.wrapper.off(e,t)}init(e){this.wrapper.init(e)}destroy(){this.wrapper.destroy()}setActive(e){this.wrapper.setActive(e)}getActive(){return this.wrapper.getActive()}getType(){return this.wrapper.getType()}getGameObject(){return this.wrapper.getGameObject()}setGameObject(e){this.wrapper.setGameObject(e)}}class l extends a{constructor(e){super(new r),this.getType=()=>"Transform";const t={position:{x:0,y:0},size:{x:0,y:0},rotation:0,scale:{x:1,y:1},anchor:{x:0,y:0}};e&&Object.assign(t,e),this.localPosition=t.position,this.localRotation=t.rotation,this.localScale=t.scale}static toLocalSpace(e,t){var i,s;const o=null===(s=null===(i=t.getGameObject())||void 0===i?void 0:i.getParent())||void 0===s?void 0:s.getTransform(),{x:n,y:r}=e,{x:a,y:h}=o?l.toLocalSpace(t.worldPosition,o):t.worldPosition,{x:c,y:d}=t.localScale;return{x:(n-a)/c,y:(r-h)/d}}static toWorldSpace(e,t){var i,s;const o=null===(s=null===(i=t.getGameObject())||void 0===i?void 0:i.getParent())||void 0===s?void 0:s.getTransform(),{x:n,y:r}=e,{x:a,y:h}=o?l.toWorldSpace(t.localPosition,o):t.localPosition,{x:c,y:d}=t.localScale;return{x:n*c+a,y:r*d+h}}get worldPosition(){var e,t;const i=null===(t=null===(e=this.getGameObject())||void 0===e?void 0:e.getParent())||void 0===t?void 0:t.getTransform();return i?l.toWorldSpace(this.localPosition,i):this.localPosition}set worldPosition(e){this.localPosition=l.toLocalSpace(e,this)}get scaleX(){return this.localScale.x}set scaleX(e){this.localScale.x=e}get scaleY(){return this.localScale.y}set scaleY(e){this.localScale.y=e}init(e){super.init(e)}}class h{constructor(e){var t,i,s,o;this.isDestroyed=!1,this.isActive=null===(t=e.startActive)||void 0===t||t,this.parent=e.parent,this.children=[],this.components=[];const n=null===(i=e.components)||void 0===i?void 0:i.find((e=>e instanceof l));this.transform=n instanceof l?n:this.createDefaultTransform(),(null!==(s=e.children)&&void 0!==s?s:[]).forEach((e=>this.addChildren(e))),[...null!==(o=e.components)&&void 0!==o?o:[],this.transform].forEach((e=>this.addComponent(e)))}createDefaultTransform(){return new l({position:{x:0,y:0},rotation:0,scale:{x:1,y:1}})}on(e,t){var i;null===(i=this.game)||void 0===i||i.events.on(e,t)}once(e,t){var i;null===(i=this.game)||void 0===i||i.events.once(e,t)}off(e,t){var i;null===(i=this.game)||void 0===i||i.events.off(e,t)}init(e){if(this.isDestroyed)throw new Error("Cannot initialize a destroyed game object");this.game=e,this.components.forEach((e=>e.init(this))),this.children.forEach((t=>t.init(e)))}destroy(){var e;if(this.isDestroyed)throw new Error("Cannot destroy a destroyed game object");this.game=void 0,this.children.forEach((e=>e.destroy())),this.components.forEach((e=>e.destroy())),null===(e=this.parent)||void 0===e||e.removeChildren(this),this.isDestroyed=!0}setActive(e){this.isActive=e,this.components.forEach((t=>t.setActive(e))),this.children.forEach((t=>t.setActive(e)))}getActive(){return this.isActive}getTransform(){return this.transform}getGame(){return this.game}getComponent(e){return this.components.find((t=>t.getType()===e))}getComponents(e){return this.components.filter((t=>t.getType()===e))}getAllComponents(){return this.components}getComponentsInChildren(e){return this.children.reduce(((t,i)=>[...t,...i.getComponentsInChildren(e)]),this.getComponents(e))}addComponent(e){return this.components.push(e),e.setGameObject(this),e}removeComponent(e){const t=this.components.indexOf(e);if(-1===t)throw new Error("Cannot remove a component that does not exist");return this.components.splice(t,1)[0]}addChildren(e){return this.children.push(e),e.setParent(this),e}removeChildren(e){e.setParent(void 0);const t=this.children.indexOf(e);if(-1===t)throw new Error("Cannot remove a game object that does not exist");return this.children.splice(t,1)[0]}getChildren(){return this.children}getParent(){return this.parent}setParent(e){this.parent=e}}class c{constructor(e){this.wrappee=e}on(e,t){this.wrappee.on(e,t)}once(e,t){this.wrappee.once(e,t)}off(e,t){this.wrappee.off(e,t)}init(e){this.wrappee.init(e)}destroy(){this.wrappee.destroy()}setActive(e){this.wrappee.setActive(e)}getActive(){return this.wrappee.getActive()}getTransform(){return this.wrappee.getTransform()}getGame(){return this.wrappee.getGame()}getComponent(e){return this.wrappee.getComponent(e)}getComponents(e){return this.wrappee.getComponents(e)}getAllComponents(){return this.wrappee.getAllComponents()}getComponentsInChildren(e){return this.wrappee.getComponentsInChildren(e)}addComponent(e){return this.wrappee.addComponent(e)}removeComponent(e){return this.wrappee.removeComponent(e)}addChildren(e){return this.wrappee.addChildren(e)}removeChildren(e){return this.wrappee.removeChildren(e)}getChildren(){return this.wrappee.getChildren()}getParent(){return this.wrappee.getParent()}setParent(e){this.wrappee.setParent(e)}}class d extends a{constructor(e){super(new r),this.config=Object.assign({text:"Sample Text",color:"black",size:"12px",fontFamily:"Arial"},e)}init(e){var t,i;super.init(e),null===(i=null===(t=this.getGameObject())||void 0===t?void 0:t.getGame())||void 0===i||i.renderer.on("render","ui",(({context:e})=>{this.render(e)}))}render(e){var t,i,s,o;const n=this.getGameObject();if(!n)throw console.trace(),new Error("Label.render: gameObject is undefined");if(!n)throw console.trace(),new Error("Label.render: gameObject is undefined");const r=n.getTransform();e.fillStyle=null!==(t=this.config.color)&&void 0!==t?t:"black",e.font=`${null!==(i=this.config.size)&&void 0!==i?i:"12px"} ${null!==(s=this.config.fontFamily)&&void 0!==s?s:"Arial"}`,e.fillText(null!==(o=this.config.text)&&void 0!==o?o:"Sample Text",r.worldPosition.x,r.worldPosition.y)}}const p={x:400,y:600},m=new h({components:[new l({position:{x:20,y:p.y-20},rotation:0,scale:{x:1,y:1}}),new d({text:"a/d or ← → to move.",color:"black",size:"16px",fontFamily:"Consolas"})]});class g extends a{constructor(e){var t,i,s;super(new r),this.getType=()=>"SpriteRenderer",this.getFlipX=()=>this.flipX,this.setFlipX=e=>{this.flipX=e},this.getFlipY=()=>this.flipY,this.setFlipY=e=>{this.flipY=e},this.setImageSource=e=>{this.image.src=e},this.getImageSource=()=>this.image.src,this.onUpdate=e=>{this.render(this.getGameObject())},this.layer=e.layer,this.size=null!==(t=e.size)&&void 0!==t?t:{x:1,y:1},this.baseColor=null!==(i=e.baseColor)&&void 0!==i?i:"white",this.imageLoaded=!1,this.image=new Image,this.image.onload=()=>{this.imageLoaded=!0,this.render(this.getGameObject())},this.image.src=null!==(s=e.imageSrc)&&void 0!==s?s:"",this.render=this.render.bind(this),this.drawImage=this.drawImage.bind(this),this.drawRectangle=this.drawRectangle.bind(this)}init(e){var t,i;super.init(e),null===(i=null===(t=this.getGameObject())||void 0===t?void 0:t.getGame())||void 0===i||i.renderer.on("render",this.layer,(()=>{this.render(this.getGameObject())}))}render(e){var t;if(!e)throw console.trace(),new Error("SpriteRenderer.render: gameObject is undefined");const i=null===(t=e.getGame())||void 0===t?void 0:t.context;if(!i)throw console.trace(),new Error("SpriteRenderer.render: context is undefined or");this.getActive()&&(this.image&&this.imageLoaded?this.drawImage(e,i):this.drawRectangle(e,i))}drawImage(e,t){const i=e.getTransform();if(!this.image)throw console.trace(),new Error("SpriteRenderer.drawImage: image is undefined");t.save(),t.setTransform(this.flipX?-1:1,0,0,this.flipY?-1:1,this.flipX?this.image.width:0,this.flipY?this.image.height:0),this.flipX?t.scale(-1,1):t.scale(1,1),t.drawImage(this.image,i.worldPosition.x,i.worldPosition.y,this.size.x*i.localScale.x,this.size.y*i.localScale.y),t.restore()}drawRectangle(e,t){const i=e.getTransform();t.fillStyle=this.baseColor,t.fillRect(i.worldPosition.x,i.worldPosition.y,this.size.x*i.localScale.x,this.size.y*i.localScale.y)}}const v=e.p+"33db91d5a34ec289a8ef.png",y=e.p+"fbf36560266a8a6b0992.png";class u extends a{get x(){return this.transform?l.toWorldSpace(this.offsetFromTransform,this.transform).x:this.offsetFromTransform.x}set x(e){this.offsetFromTransform.x=this.transform?l.toLocalSpace({x:e,y:this.offsetFromTransform.y},this.transform).x:e}get y(){return this.transform?l.toWorldSpace(this.offsetFromTransform,this.transform).y:this.offsetFromTransform.y}set y(e){this.offsetFromTransform.y=this.transform?l.toLocalSpace({x:this.offsetFromTransform.x,y:e},this.transform).y:e}get width(){return this.size.x}set width(e){this.size.x=e}get height(){return this.size.y}set height(e){this.size.y=e}get right(){return this.x+this.size.x}set right(e){this.x=e-this.size.x}get left(){return this.x}set left(e){this.x=e}get top(){return this.y}set top(e){this.y=e}get bottom(){return this.y+this.size.y}set bottom(e){this.y=e-this.size.y}get centerX(){return this.x+this.size.x/2}set centerX(e){this.x=e-this.size.x/2}get centerY(){return this.y+this.size.y/2}set centerY(e){this.y=e-this.size.y/2}get halfWidth(){return this.size.x/2}set halfWidth(e){this.size.x=2*e}get halfHeight(){return this.size.y/2}set halfHeight(e){this.size.y=2*e}isCollidingWith(e){return e instanceof u&&this.collideRectangle(e)}getCollidingColliders(){return this.collidingWith}addCollidingCollider(e){this.collidingWith.push(e)}removeCollidingCollider(e){this.collidingWith=this.collidingWith.filter((t=>t.colliderId!==e))}onCollision(e,t){this.eventManager.on(e,t)}onceCollision(e,t){this.eventManager.once(e,t)}offCollision(e,t){this.eventManager.off(e,t)}emitCollision(e,t){this.eventManager.emit(e,t)}constructor(e){var t;super(new r),this.colliderId=-1,this.mass=1,this.tag="Default",this.getType=()=>"Collider",this.getColliderType=()=>"RectangleCollider",this.collidingWith=[],this.eventManager=new i,this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.offsetFromTransform=e.position,this.size=e.size,this.tag=e.tag,this.debug=null!==(t=e.debug)&&void 0!==t&&t,this.transform=void 0,this.debugRenderer=new g({layer:"ui",size:this.size,baseColor:"red"}),this.debugGameObject=new h({components:[new l({position:this.offsetFromTransform}),this.debugRenderer]})}isPointInCollider(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}collideRectangle(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top}init(e){var t,i;super.init(e),this.debug&&this.setDebug(!0),this.getActive()&&(this.colliderId=null!==(i=null===(t=e.getGame())||void 0===t?void 0:t.physics.registerCollider(this))&&void 0!==i?i:-1),this.transform=e.getTransform()}setActive(e){var t,i,s,o,n;if(super.setActive(e),!0===e&&-1===this.colliderId)this.colliderId=null!==(s=null===(i=null===(t=this.getGameObject())||void 0===t?void 0:t.getGame())||void 0===i?void 0:i.physics.registerCollider(this))&&void 0!==s?s:-1;else if(!1===e){if(-1===this.colliderId)throw new Error("Collider id is -1");null===(n=null===(o=this.getGameObject())||void 0===o?void 0:o.getGame())||void 0===n||n.physics.unregisterCollider(this.colliderId),this.colliderId=-1}}setDebug(e){this.debug=e;const t=this.getGameObject();t&&(e?(t.addChildren(this.debugGameObject),this.debugRenderer.init(t),this.debugRenderer.setActive(!0)):(this.debugRenderer.setActive(!1),t.removeChildren(this.debugGameObject)))}}const f=new h({components:[new l({position:{x:p.x-160,y:40},rotation:0,scale:{x:1,y:1}}),new d({text:"Doodle Jump",color:"black",size:"24px",fontFamily:"Consolas"})]}),w=new h({components:[new l({position:{x:p.x-80,y:p.y-20},rotation:0,scale:{x:1,y:1}}),new class extends a{constructor(e){const t=new d(e);super(t),this.fps=0,this.lastTime=0,this.frameCount=0,this.label=t}init(e){super.init(e),this.on("start",(()=>{this.lastTime=performance.now()})),this.on("update",(e=>{this.onUpdate(e)}))}onUpdate(e){var t,i;this.label.render(null===(i=null===(t=this.getGameObject())||void 0===t?void 0:t.getGame())||void 0===i?void 0:i.context),this.frameCount++;const s=performance.now(),o=s-this.lastTime;o>1e3&&(this.fps=Math.round(1e3*this.frameCount/o),this.label.config.text=`FPS: ${this.fps}`,this.frameCount=0,this.lastTime=s)}}({color:"black",size:"16px",fontFamily:"Consolas"})]}),x=e.p+"a2d0bac2e017f75b1dcc.png",b=e.p+"1c493e0e20898f7e05d4.png",C=e.p+"6595e1456ed4a1f0761d.png",P=e.p+"644b6d78099efb3a69e3.png";class A extends a{constructor(e){var t,i,s;super(new r),this.getType=()=>"Rigidbody",this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.mass=null!==(t=null==e?void 0:e.mass)&&void 0!==t?t:1,this.gravity=null!==(i=null==e?void 0:e.gravity)&&void 0!==i?i:0,this.drag=null!==(s=null==e?void 0:e.drag)&&void 0!==s?s:0}init(e){super.init(e),this.transform=e.getTransform(),e.on("update",(()=>{this.update()}))}update(){this.velocity.x+=this.acceleration.x,this.velocity.y+=this.acceleration.y+this.gravity,this.velocity.x*=1-this.drag,this.transform&&(this.transform.localPosition.x+=this.velocity.x,this.transform.localPosition.y+=this.velocity.y)}addForce(e){this.velocity.x+=e.x/this.mass,this.velocity.y+=e.y/this.mass}}const O=new class extends c{getScore(){return this.score}constructor(e){var t;const i=new A({mass:e.mass,gravity:e.gravity,drag:e.drag}),s=new u({tag:"Player",position:{x:0,y:20},size:{x:55,y:30}}),o=new g({layer:"foreground",size:{x:75,y:75},baseColor:"white",imageSrc:x});super(new h({startActive:e.startActive,parent:e.parent,children:[...null!==(t=e.children)&&void 0!==t?t:[]],components:[i,o,s]})),this.speed=e.speed/10,this.collider=s,this.spriteRenderer=o,this.rigidbody=i,this.score=0,this.control={left:!1,right:!1}}init(e){super.init(e),this.on("update",(()=>{this.score=this.getTransform().localPosition.y<this.score?this.getTransform().localPosition.y:this.score,this.move()})),document.addEventListener("keydown",(e=>{this.onKeyDown(e)})),document.addEventListener("keyup",(e=>{this.onKeyUp(e)}))}move(){let e=0;this.control.left&&(e-=1),this.control.right&&(e+=1),this.rigidbody.velocity.y<0?this.lastMoveDirection<0?this.spriteRenderer.setImageSource(C):this.spriteRenderer.setImageSource(P):this.lastMoveDirection<0?this.spriteRenderer.setImageSource(x):this.spriteRenderer.setImageSource(b),this.lastMoveDirection=0!==e?e:this.lastMoveDirection,this.rigidbody.addForce({x:e*this.speed,y:0})}onKeyDown(e){"ArrowLeft"===e.key?this.control.left=!0:"ArrowRight"===e.key&&(this.control.right=!0),"a"===e.key?this.control.left=!0:"d"===e.key&&(this.control.right=!0)}onKeyUp(e){"ArrowLeft"===e.key?this.control.left=!1:"ArrowRight"===e.key&&(this.control.right=!1),"a"===e.key?this.control.left=!1:"d"===e.key&&(this.control.right=!1)}}({size:{x:50,y:80},mass:1,speed:15,gravity:.2,drag:.25}),z=O.getTransform();if(!z)throw new Error("Player must have a transform");z.localPosition.x=p.x/2-25,z.localPosition.y=p.y/2-25;const T=e.p+"a026fa57de7467d5344d.png";class j extends c{constructor(e){super(new h({startActive:e.startActive,parent:e.parent,children:[],components:[]}));const t=new u({tag:"Platform",position:{x:0,y:-18},size:{x:60,y:20}});t.onCollision("collisionEnter",(({other:t})=>{var i,s,o,n;if("Player"===t.tag){const r=null===(i=t.getGameObject())||void 0===i?void 0:i.getComponent("Rigidbody");if(!r)return;if(r.velocity.y>0){const i=null===(s=t.getGameObject())||void 0===s?void 0:s.getTransform(),a=null===(n=null===(o=t.getGameObject())||void 0===o?void 0:o.getParent())||void 0===n?void 0:n.getTransform(),h=this.getComponent("Collider");i&&a&&h&&(i.localPosition.y=l.toLocalSpace({x:0,y:h.top},a).y-2*h.height),r.velocity.y=0,r.addForce({x:0,y:-e.bounciness})}}})),[new g({layer:"layer_1",baseColor:"white",size:{x:75,y:20},imageSrc:T}),t].forEach((e=>{this.addComponent(e)})),this.getTransform().localPosition.x=e.position.x,this.getTransform().localPosition.y=e.position.y}init(e){super.init(e),this.getAllComponents().forEach((e=>{e.init(this)}))}}const S=e.p+"813c200bbbbffc56fd7b.png",G=e.p+"3408b41cac91907aa76d.png",E=new class extends c{constructor(e){var t,i;const s=new h({}),o=new u({size:{x:e.triggerArea.size.x,y:e.triggerArea.size.y},position:{x:e.triggerArea.position.x,y:e.triggerArea.position.y},tag:"Ceiling"});super(new h({startActive:e.startActive,children:[...null!==(t=e.children)&&void 0!==t?t:[],s],components:[...null!==(i=e.components)&&void 0!==i?i:[],o]})),this.viewGameObject=s,this.viewTransform=s.getTransform(),this.smoothing=e.smoothing,this.playerCollider=e.playerCollider,this.viewportSize=e.viewportSize,this.scrollDistance=0,this.triggerCollider=o,this.triggerCollider.onCollision("collisionStay",(({other:e})=>{var t;const i=null===(t=e.getGameObject())||void 0===t?void 0:t.getComponent("Rigidbody");i&&"Player"===e.tag&&i.velocity.y<0&&this.addScrollDistance(-i.velocity.y)}))}init(e){super.init(e),this.scrollDistance=0,this.on("update",(()=>{this.move()}))}move(){this.viewTransform&&(this.viewTransform.localPosition.y+=this.scrollDistance*this.smoothing,this.scrollDistance*=1-this.smoothing)}addScrollDistance(e){this.scrollDistance+=e}getScrollDistance(){return this.scrollDistance}setScrollDistance(e){this.scrollDistance=e}getSmoothing(){return this.smoothing}getScrollViewGameObject(){return this.viewGameObject}}({smoothing:.2,playerCollider:O.getComponent("Collider"),triggerArea:{size:{x:p.x,y:p.y/2.5},position:{x:0,y:0}},viewportSize:p}),k={scrollView:E,scrollViewPadding:50,position:{x:0,y:0},color:"black",size:{x:60,y:20},bounciness:10},D=new j(Object.assign(Object.assign({},k),{position:{x:p.x/2-50,y:p.y/2+190}})),I=new j(Object.assign(Object.assign({},k),{position:{x:p.x/2-150,y:p.y/2+100}})),R=new j(Object.assign(Object.assign({},k),{position:{x:p.x/2+50,y:p.y/2}})),_=new j(Object.assign(Object.assign({},k),{position:{x:p.x/2-100,y:p.y/2-100}})),F=new j(Object.assign(Object.assign({},k),{position:{x:p.x/2+100,y:p.y/2-200}})),L=new j(Object.assign(Object.assign({},k),{position:{x:p.x/2+50,y:p.y/2-400}})),M=E.getScrollViewGameObject();[O,D,I,R,_,F,L].forEach((e=>{M.addChildren(e)}));const W=new class extends c{constructor(e){var t,i,s,o,n;const r=new u({tag:"PlatformSpawner",position:{x:e.spawnArea.position.x,y:e.spawnArea.position.y-e.minimumPlatformDistance},size:{x:e.spawnArea.size.x,y:e.spawnArea.size.y}}),a=new u({tag:"PlatformSpawner",position:{x:e.spawnArea.position.x,y:e.spawnArea.position.y-e.minimumPlatformDistance},size:{x:e.spawnArea.size.x,y:e.spawnArea.size.y+e.minimumPlatformDistance}}),c=new u({tag:"PlatformSpawner",position:{x:e.despawnArea.position.x,y:e.despawnArea.position.y},size:{x:e.despawnArea.size.x,y:e.despawnArea.size.y}}),d=[new h({components:[new l({position:{x:e.spawnArea.position.x,y:e.spawnArea.position.y-e.minimumPlatformDistance}}),new g({layer:"background",baseColor:"green",size:{x:e.spawnArea.size.x,y:e.spawnArea.size.y+e.minimumPlatformDistance}})],parent:e.parent,children:[...null!==(t=e.children)&&void 0!==t?t:[]]}),new h({components:[new l({position:{x:e.spawnArea.position.x,y:e.spawnArea.position.y-e.minimumPlatformDistance}}),new g({layer:"background",baseColor:"red",size:{x:e.spawnArea.size.x,y:e.spawnArea.size.y}})],parent:e.parent,children:[...null!==(i=e.children)&&void 0!==i?i:[]]}),new h({components:[new l({position:{x:e.despawnArea.position.x,y:e.despawnArea.position.y}}),new g({layer:"layer_1",baseColor:"blue",size:{x:e.despawnArea.size.x,y:e.despawnArea.size.y}})],parent:e.parent,children:[...null!==(s=e.children)&&void 0!==s?s:[]]})];a.onCollision("collisionExit",(({other:e})=>{"Platform"===e.tag&&this.trySpawnPlatform()})),c.onCollision("collisionEnter",(({other:e})=>{const t=e.getGameObject();if(void 0===t)throw new Error("Game object is not set");"Platform"===e.tag&&t instanceof j&&this.recyclePlatform(t)})),super(new h({startActive:e.startActive,parent:e.parent,children:[...null!==(o=e.children)&&void 0!==o?o:[],...d],components:[...null!==(n=e.components)&&void 0!==n?n:[],r,c,a]})),this.bufferCollider=a,this.spawnCollider=r,this.spawnParentObject=e.spawnParentObject,this.platformTemplate=e.platformTemplate,this.spawned=[],this.pool=[]}init(e){super.init(e),this.on("start",(()=>{this.preparePlatform()}))}preparePlatform(){const e=this.getGame();if(void 0===e)throw new Error("Game is not set");this.spawnPlatform(e)}trySpawnPlatform(){const e=this.getGame();if(void 0===e)throw new Error("Game is not set");this.bufferCollider.getCollidingColliders().some((e=>"Platform"===e.tag))||this.spawnPlatform(e)}spawnPlatform(e){const t=[this.spawnCollider.left,this.spawnCollider.right-this.platformTemplate.size.x],i=[this.spawnCollider.top,this.spawnCollider.bottom];let s={x:Math.random()*(t[1]-t[0])+t[0],y:Math.random()*(i[1]-i[0])+i[0]};s=l.toLocalSpace(s,this.spawnParentObject.getTransform());let o=this.pool.pop();void 0===o?o=new j(Object.assign(Object.assign({},this.platformTemplate),{position:s})):o.getTransform().localPosition=s,o.init(e),o.setActive(!0),this.spawned.push(o),this.spawnParentObject.addChildren(o)}recyclePlatform(e){this.spawned.includes(e)&&(e.setActive(!1),this.RemovePlatformFromParent(e),this.spawned.splice(this.spawned.indexOf(e),1),this.pool.push(e))}RemovePlatformFromParent(e){const t=e.getParent();void 0!==t&&t.removeChildren(e)}}({canvasSize:p,spawnArea:{size:{x:p.x-40,y:40},position:{x:p.x/2-(p.x-40)/2,y:-40}},despawnArea:{size:{x:p.x,y:p.y},position:{x:0,y:p.y+10}},minimumPlatformDistance:30,spawnParentObject:M,platformTemplate:k}),X=new h({components:[new l({position:{x:20,y:40}}),new class extends a{constructor(e,t,i){const s=new d(i);super(s),this.label=s,this.scrollViewTransform=e.getTransform(),this.player=t}init(e){super.init(e),this.on("update",(()=>{this.label.config.text=`Score: ${Math.floor(Math.round(-this.player.getScore()/10))}`}))}}(M,O,{color:"black",size:"24px",fontFamily:"Consolas"})]}),Y=new class extends c{constructor(e){const t=new u({tag:"Wall",size:{x:10,y:p.y},position:{x:0,y:0}}),i=new u({tag:"Wall",size:{x:10,y:p.y},position:{x:0,y:0}}),s=new h({components:[new l({position:{x:-10,y:0}}),t]}),o=new h({components:[new l({position:{x:p.x,y:0}}),i]});super(new h({children:[s,o]})),t.onCollision("collisionStay",(({other:e})=>{this.tryTeleportPlayer(!0,e)})),i.onCollision("collisionStay",(({other:e})=>{this.tryTeleportPlayer(!1,e)})),this.teleportTolerance=e.teleportTolerance,this.leftCollider=t,this.rightCollider=i}tryTeleportPlayer(e,t){var i,s,o,n;const r=null===(i=t.getGameObject())||void 0===i?void 0:i.getTransform();if(r){if("Player"===t.tag){const i=null!==(n=null===(o=null===(s=r.getGameObject())||void 0===s?void 0:s.getParent())||void 0===o?void 0:o.getTransform())&&void 0!==n?n:null;if(!i)return void console.warn("player parent transform is null");e&&this.leftCollider.right-t.right>this.teleportTolerance?r.localPosition.x=l.toLocalSpace(this.rightCollider,i).x-t.width/2-this.teleportTolerance:!e&&t.left-this.rightCollider.left>this.teleportTolerance&&(r.localPosition.x=l.toLocalSpace(this.leftCollider,i).x-t.width/2+this.teleportTolerance)}}else console.warn("otherTransform is null")}}({teleportTolerance:2}),$=new class extends c{constructor(e){const t=new u({tag:"Trigger",size:{x:400,y:100},position:{x:0,y:0}}),i=new h({components:[t],children:[new h({components:[new l({position:{x:0,y:0}}),new g({layer:"background",size:{x:1e3,y:1e3},baseColor:"black"})]}),new h({components:[new l({position:{x:0,y:0}}),new g({layer:"background",size:{x:400,y:600},baseColor:"white",imageSrc:v})]}),new h({components:[new l({position:{x:0,y:600}}),new g({layer:"background",size:{x:400,y:600},baseColor:"white",imageSrc:v})]}),new h({components:[new l({position:{x:0,y:1200}}),new g({layer:"background",size:{x:400,y:100},baseColor:"white",imageSrc:y})]})]});super(i),this.collider=t,this.transform=i.getTransform(),this.scrollDistance=e.onGameOverScrollDistance,this.smoothing=e.smoothing,this.startingPosition=this.transform.localPosition.y}move(){this.collider.velocity.y>0&&(this.transform.localPosition.y-=this.collider.velocity.y*this.smoothing,this.collider.velocity.y*=1-this.smoothing)}init(e){super.init(e),this.on("update",(()=>{this.move()}))}setGameOver(e){e?this.collider.velocity.y=this.scrollDistance:(this.collider.velocity.y=0,this.transform.localPosition.y=this.startingPosition)}}({onGameOverScrollDistance:750,smoothing:.1}),H=new class extends c{constructor(e){const t=new u({tag:"GameOverTrigger",position:{x:0,y:e.backgroundHeight},size:{x:p.x,y:1}});t.onCollision("collisionEnter",(({other:e})=>{"Player"===e.tag&&(console.log("game over"),this.background.setGameOver(!0),this.scrollview.setScrollDistance(-600),this.collider.setActive(!1))})),super(new h({components:[t]})),this.background=e.background,this.scrollview=e.scrollview,this.collider=t}}({scrollview:E,background:$,backgroundHeight:600}),U=new class extends c{constructor(){const e=new h({components:[new g({baseColor:"white",layer:"ui",size:p,imageSrc:S})],children:[new h({components:[new l({position:{x:p.x/2-95,y:p.y/2-120},rotation:0,scale:{x:1,y:1}}),new g({baseColor:"white",layer:"ui",size:{x:100,y:45},imageSrc:G})]})]});super(e),this.overlayObject=e}init(e){super.init(e),this.overlayObject.on("start",(()=>{var e;null===(e=this.overlayObject.getGame())||void 0===e||e.canvas.addEventListener("click",(e=>{var t,i,s;const o=null===(t=this.overlayObject.getGame())||void 0===t?void 0:t.canvas,n=null==o?void 0:o.getBoundingClientRect(),r=e.clientX-(null!==(i=null==n?void 0:n.left)&&void 0!==i?i:0),a=e.clientY-(null!==(s=null==n?void 0:n.top)&&void 0!==s?s:0);r>160&&r<330&&a>290&&a<353&&(console.log("clicked"),this.setActive(!1))}))}))}},V=new class{get gameObjects(){return this._gameObjects}constructor(e,t){var r;this.runtimeEventManager=new i,this.runtimeEventManager.on("error",(e=>{console.trace(`Game stopped be cause of a fatal: ${e}. Stack trace:`),this.stop()})),this.events=new i,this.physics=new n(this),this.raf=new o,this.hasInitialized=!1,this._gameObjects=e,this.canvas=this.initCanvas(null!=t?t:{x:0,y:0}),this.context=this.canvas.getContext("2d"),this.renderer=new s(this),this.start=this.start.bind(this),this.update=this.update.bind(this),this.stop=this.stop.bind(this),this.destroy=this.destroy.bind(this),null===(r=document.getElementById("game"))||void 0===r||r.appendChild(this.canvas)}init(){this.hasInitialized||(this.hasInitialized=!0,this._gameObjects.forEach((e=>{e.init(this)})))}start(){this.hasInitialized||console.error("Game has not been initialized"),this.events.emit("start"),this.raf.start(this.update),this.lastFrameTime=performance.now()}update(){const e=performance.now(),t=e-this.lastFrameTime;this.lastFrameTime=e,this.events.emit("update",t)}stop(){this.events.emit("stop"),this.raf.stop()}destroy(){this.events.emit("destroy"),this.raf.destroy()}initCanvas(e){const t=document.createElement("canvas");return t.width=e?e.x:window.innerWidth,t.height=e?e.y:window.innerHeight,t}}([$,H,E,Y,W,X,w,f,m,U],p);V.init(),V.start()})();